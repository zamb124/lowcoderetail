{# core_sdk/frontend/templates/components/table.html #}
{# Ожидает: ctx (RenderContext), request, user, url_for #}
<div class="card shadow-sm"
     id="{{ ctx.html_id }}"
     list-model="{{ ctx.model_name }}"
     hx-trigger="change from:#filter--{{ ctx.model_name }} delay:500ms, update delay:500ms"
     hx-get="{{ url_for('get_list_rows', model_name=ctx.model_name) }}"
     hx-target="#tbody-table--{{ ctx.model_name }}"
     hx-include="#filter--{{ ctx.model_name }}"
     >
    <div class="card-header">
        <h3 class="card-title">{{ ctx.title }}</h3>
        <div class="card-toolbar">
            {% if ctx.can_create %}
                <button type="button" class="btn btn-primary"
                        hx-get="{{ url_for('get_create_form', model_name=ctx.model_name) }}"
                        hx-target="#modal-placeholder"
                        hx-swap="innerHTML">
                    <i class="ti ti-plus me-1"></i> Создать {{ ctx.model_name }}
                </button>
            {% endif %}
        </div>
    </div>
    <div class="card-body py-3">
        <div class="table-responsive">
            <table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
                <thead>
                <tr class="fw-bold text-muted">
                    {% for field_ctx_proto in ctx.fields %} {# ctx.fields содержит прототипы колонок #}
                        {% if field_ctx_proto.name not in ['id', 'lsn', 'vars', 'hashed_password'] and not field_ctx_proto.extra.get('table_hidden') %}
                            <th class="min-w-150px">{{ field_ctx_proto.label }}
                                {% if field_ctx_proto.description %}
                                    <span>
                                    <i class="ti ti-info-circle ms-1 text-muted align-middle"
                                       style="cursor: help; font-size: 0.9em; vertical-align: middle;"
                                       data-bs-toggle="tooltip" data-bs-placement="top"
                                       title="{{ field_ctx_proto.description | escape }}"></i></span>
                                {% endif %}
                            </th>

                        {% endif %}
                    {% endfor %}
                    <th class="min-w-100px text-end">Действия</th>
                </tr>
                </thead>
                <tbody id="tbody-table--{{ ctx.model_name }}">
                {% if ctx.items %}
                    {% with
                        items=ctx.items,
                        model_name=ctx.model_name,
                        ctx=ctx,
                        request=request,
                        user=user,
                        table_key=ctx.table_key %}
                        {% include "components/_table_rows_fragment.html" %}
                    {% endwith %}
                {% else %}
                    <tr>
                        {% set colspan_count = ctx.fields | rejectattr('name', 'in', ['id', 'lsn', 'vars', 'hashed_password']) | rejectattr('extra.table_hidden') | list | length + 1 %}
                        <td colspan="{{ colspan_count }}" class="text-center text-muted fs-4 py-10">Нет данных для
                            отображения
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
        <div id="table-loading-indicator-{{ ctx.model_name }}" class="htmx-indicator text-center py-5"
             style="display: none;">
            <span class="spinner-border spinner-border-sm align-middle ms-2"></span> Загрузка...
        </div>
    </div>
</div>
<div id="modal-placeholder"></div>