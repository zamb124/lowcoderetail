{# core_sdk/frontend/templates/components/_table_rows_fragment.html #}
{# Ожидает: items, model_name, ctx (RenderContext с pagination), request, user, table_key #}

{% if items %}
    {% for item in items %}
        {% set row_hx_attrs = {} %}
        {% if loop.last and ctx.pagination and ctx.pagination.next_cursor %}
            {# Формируем базовый URL для подгрузки строк #}
            {% set base_next_url = url_for('get_list_rows', model_name=model_name) %}
            {# hx-vals будет содержать только параметры пагинации #}
            {% set hx_vals_dict = {
                "cursor": ctx.pagination.next_cursor,
                "limit": ctx.pagination.limit
            } %}
            {# ID формы фильтров #}
            {% set filter_form_id = '#filter--' ~ table_key %}
            {% set row_hx_attrs = {
                "hx-get": base_next_url,
                "hx-include": filter_form_id,
                "hx-vals": hx_vals_dict|tojson,
                "hx-trigger": "revealed",
                "hx-swap": "afterend",
                "hx-indicator": "#table-loading-indicator-" ~ ctx.model_name
            } %}
        {% endif %}

        {# Используем with для передачи переменных в include #}
        {% with
            item=item,
            model_name=model_name,
            fields=ctx.fields,
            request=request,
            user=user,
            ctx=ctx,
            row_hx_attrs=row_hx_attrs
        %}
            {% include "components/_table_row.html" %}
        {% endwith %}
    {% endfor %}
{% endif %}