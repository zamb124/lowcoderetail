{# core_sdk/frontend/templates/components/_modal_wrapper.html #}
{# Ожидает: modal_id, modal_title, modal_size, content_url #}
{# А также ctx (RenderContext), если кнопки футера зависят от режима (view/edit/create) #}
{# ctx будет доступен, если get_modal_wrapper его передаст, или если этот шаблон #}
{# используется как базовый для _modal_view_wrapper / _modal_form_wrapper, которые получают ctx #}

<div class="modal fade" tabindex="-1" id="{{ modal_id }}">
    <div class="modal-dialog {{ modal_size | default('modal-xl') }} modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" id="{{ modal_id }}-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ modal_title | default("Модальное окно") }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"
                 hx-get="{{ content_url }}"
                 hx-trigger="load"
                 hx-swap="innerHTML"
                 >
                <div class="text-center p-5"> {# Плейсхолдер загрузки #}
                    <span class="spinner-border text-primary" role="status"></span>
                    <p class="mt-2">Загрузка содержимого...</p>
                </div>
            </div>
            <div class="modal-footer">
                {# Этот футер теперь может быть почти пустым, если form.html/view.html #}
                {# сами управляют своими кнопками. #}
                {# Оставим только универсальную кнопку "Закрыть", если контент не предоставит свою "Отмену". #}
                {# Но form.html и view.html теперь имеют свои кнопки "Отмена" с data-bs-dismiss="modal". #}
                {# Поэтому этот футер может быть полностью пустым. #}
                {% block modal_footer_buttons %}
                    {# Пусто, так как form.html и view.html теперь содержат свои кнопки #}
                    {# Если бы они не содержали, здесь была бы кнопка: #}
                    {# <button type="button" class="btn btn-light" data-bs-dismiss="modal">Закрыть</button> #}
                {% endblock modal_footer_buttons %}
            </div>
        </div>
    </div>
</div>
<script>
// ... (JS для показа/скрытия/удаления модалки, как был) ...
(function() {
    const modalId = '{{ modal_id }}';
    let modalElement = document.getElementById(modalId);
    if (modalElement) {
        const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
        const handleModalHidden = (event) => { /* ... */ };
        modalElement.addEventListener('hidden.bs.modal', handleModalHidden, { once: true });
        if (!modalElement.classList.contains('show')) { modal.show(); }
        else { modal.handleUpdate(); }
    }
})();
</script>