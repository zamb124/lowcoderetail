{# core_sdk/frontend/templates/components/view.html #}
{# Ожидает: ctx, request, user, SDK_STATIC_URL, url_for #}

{% for field_ctx_loopvar in ctx.fields %}
    {% with field_ctx=field_ctx_loopvar, request=request, user=user, SDK_STATIC_URL=SDK_STATIC_URL, url_for=url_for, ctx=ctx %}
        {% include field_ctx_loopvar.template_path %} {# Шаблоны *_view.html теперь form-floating #}
    {% endwith %}
{% endfor %}

{# Кнопки для view mode #}
{% set is_inside_modal_body = request.headers.get("HX-Target") and (".modal-body" in request.headers.get("HX-Target") or ".modal-content" in request.headers.get("HX-Target")) or (ctx.html_id and "modal-view-" in ctx.html_id) %}
<div class="pt-5 mt-auto {% if not is_inside_modal_body %}border-top{% endif %}">
    <div class="d-flex justify-content-end">
        {% if is_inside_modal_body %}
            {# Кнопка "Закрыть" будет в _modal_wrapper.html #}
            {% if ctx.can_edit %}
            <button type="button" class="btn btn-primary"
                    hx-get="{{ url_for('get_edit_form', model_name=ctx.model_name, item_id=ctx.item_id) }}"
                    hx-target="closest .modal-body" {# Заменяем содержимое .modal-body #}
                    hx-swap="innerHTML">
                Редактировать
            </button>
            {% endif %}
        {% else %}
            {# ... кнопки для полностраничного view ... #}
        {% endif %}
    </div>
</div>