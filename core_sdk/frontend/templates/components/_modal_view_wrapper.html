{# core_sdk/frontend/templates/components/_modal_view_wrapper.html #}
{# Ожидает: ctx (RenderContext), request, user, SDK_STATIC_URL, url_for #}
{# Этот шаблон будет загружен в #modal-placeholder #}

{% set modal_id = "modal-view-" ~ ctx.model_name ~ "-" ~ ctx.item_id %}
{% extends "components/_modal_wrapper.html" %}

{% block modal_size %}modal-xl{% endblock %} {# Размер модального окна для просмотра #}

{% block modal_title %}{{ ctx.title }}{% endblock %}

{% block modal_body %}
    {# Вставляем содержимое страницы просмотра сюда #}
    {# view.html ожидает ctx, request, user, SDK_STATIC_URL, url_for #}
    {% include "components/view.html" %}
{% endblock %}

{% block modal_footer %}
    <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Закрыть</button>
        {# Можно добавить кнопку "Редактировать", если нужно перейти к редактированию из модалки просмотра #}
        {% if ctx.can_edit %}
        <button type="button" class="btn btn-primary"
                hx-get="{{ url_for('get_edit_form', model_name=ctx.model_name, item_id=ctx.item_id) }}"
                hx-target="#{{ modal_id }} .modal-content" {# Заменяем контент текущей модалки #}
                hx-swap="innerHTML">
            Редактировать
        </button>
        {% endif %}
    </div>
{% endblock %}
{% block modal_footer_buttons %} {# Переопределяем блок из _modal_wrapper #}
    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Закрыть</button>
    {% if ctx.can_edit %}
    <button type="button" class="btn btn-primary"
            hx-get="{{ url_for('get_edit_form', model_name=ctx.model_name, item_id=ctx.item_id) }}"
            {# Цель - заменить .modal-body текущей модалки на форму редактирования #}
            hx-target="closest .modal-content .modal-body"
            {# Или hx-target="#{{ modal_id }}-content .modal-body" #}
            hx-swap="innerHTML"
            {# Также нужно обновить заголовок и футер модалки, если они меняются #}
            {# Можно сделать hx-target на .modal-content и вернуть HTML для всего .modal-content #}
            {# Чтобы обновить и заголовок, и футер, и тело: #}
            {# hx-target="closest .modal-content" #}
            {# hx-vals='{"_modal_title": "Редактирование: {{ ctx.model_name }}"}' #} {# Не сработает так просто #}
            {# Проще, если get_edit_form вернет HTML для .modal-body + .modal-footer, #}
            {# а hx-target будет на .modal-body, и мы также обновим заголовок через HX-Trigger или JS. #}

            {# Самый простой вариант: get_edit_form возвращает ТОЛЬКО форму, #}
            {# а мы заменяем только .modal-body. Футер и заголовок остаются от просмотра. #}
            {# Это не идеально, т.к. кнопки в футере могут быть не те. #}

            {# Лучше: кнопка "Редактировать" загружает НОВУЮ модалку с формой редактирования #}
            {# поверх текущей (если нужна матрешка) или заменяет текущую. #}
            {# Для замены текущей: #}
            hx-get="{{ url_for('get_modal_wrapper', content_url=url_for('get_edit_form', model_name=ctx.model_name, item_id=ctx.item_id), modal_title='Редактирование: ' ~ ctx.model_name, modal_size='modal-xl') }}"
            hx-target="#modal-placeholder" {# Заменяем всю модалку в главном плейсхолдере #}
            hx-swap="innerHTML"
            >
        Редактировать
    </button>
    {% endif %}
{% endblock %}